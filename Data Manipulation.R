library(ggmap)
library(rjava)
library(dplyr)
library(foreign)
library(data.table)
library(maptools)
library(DataCombine)
library(tidyr)
library(lubridate)
library(ggplot2)
library(zipcode)
library(stringr)

data("zipcode")
MA <- filter(zipcode, state == 'MA')

#2006
FIRE2006 <- read.dbf("fireincident2006.dbf")
ADDRESS2006 <- read.dbf("incidentaddress2006.dbf")
MA2006 <- filter(FIRE2006, STATE=="MA")
HeatSource2006 <- filter(MA2006, HEAT_SOURC==("61")|HEAT_SOURC==("62"))
Intention2006 <- filter(HeatSource2006, CAUSE_IGN==("1"))
Fire2006 <- mutate(Intention2006, PopClass=1, YEAR=2006)
Fire2006 <- select(Fire2006, STATE, INC_DATE, INC_NO, PopClass, YEAR)
INC_MON <- substr(Fire2006$INC_DATE, 1, nchar(Fire2006$INC_DATE)-6)
INC_MONTH <- t(INC_MON)
INC_MONTH <- t(INC_MONTH)
Fire2006 <- mutate(Fire2006, INC_MONTH)
Address2006 <- filter(ADDRESS2006, STATE=="MA")
Address2006 <- select(Address2006, STATE, INC_NO, ZIP5)
FireAddress2006 <- merge(Address2006, Fire2006, by.x='INC_NO', by.y='INC_NO')
FireLocat2006 <- merge(zipcode, FireAddress2006, by.x='zip', by.y='ZIP5')
remove(MA2006)
remove(HeatSource2006)
remove(Intention2006)
remove(Fire2006)
remove(Address2006)
remove(FireAddress2006)

#2007
FIRE2007 <- read.dbf("fireincident2007.dbf")
ADDRESS2007 <- read.dbf("incidentaddress2007.dbf")
MA2007 <- filter(FIRE2007, STATE=="MA")
HeatSource2007 <- filter(MA2007, HEAT_SOURC==("61")|HEAT_SOURC==("62"))
Intention2007 <- filter(HeatSource2007, CAUSE_IGN==("1"))
Fire2007 <- mutate(Intention2007, PopClass=2, YEAR=2007)
Fire2007 <- select(Fire2007, STATE, INC_DATE, INC_NO, PopClass, YEAR)
INC_MON <- substr(Fire2007$INC_DATE, 1, nchar(Fire2007$INC_DATE)-6)
INC_MONTH <- t(INC_MON)
INC_MONTH <- t(INC_MONTH)
Fire2007 <- mutate(Fire2007, INC_MONTH)
Address2007 <- filter(ADDRESS2007, STATE=="MA")
Address2007 <- select(Address2007, STATE, INC_NO, ZIP5)
FireAddress2007 <- merge(Address2007, Fire2007, by.x='INC_NO', by.y='INC_NO')
FireLocat2007 <- merge(zipcode, FireAddress2007, by.x='zip', by.y='ZIP5')
remove(MA2007)
remove(HeatSource2007)
remove(Intention2007)
remove(Fire2007)
remove(Address2007)
remove(FireAddress2007)

#2008
FIRE2008 <- read.dbf("fireincident2008.dbf")
ADDRESS2008 <- read.dbf("incidentaddress2008.dbf")
MA2008 <- filter(FIRE2008, STATE=="MA")
HeatSource2008 <- filter(MA2008, HEAT_SOURC==("61")|HEAT_SOURC==("62"))
Intention2008 <- filter(HeatSource2008, CAUSE_IGN==("1"))
Fire2008 <- mutate(Intention2008, PopClass=3, YEAR=2008)
Fire2008 <- select(Fire2008, STATE, INC_DATE, INC_NO, PopClass, YEAR)
INC_MON <- substr(Fire2008$INC_DATE, 1, nchar(Fire2008$INC_DATE)-6)
INC_MONTH <- t(INC_MON)
INC_MONTH <- t(INC_MONTH)
Fire2008 <- mutate(Fire2008, INC_MONTH)
Address2008 <- filter(ADDRESS2008, STATE=="MA")
Address2008 <- select(Address2008, STATE, INC_NO, ZIP5)
FireAddress2008 <- merge(Address2008, Fire2008, by.x='INC_NO', by.y='INC_NO')
FireLocat2008 <- merge(zipcode, FireAddress2008, by.x='zip', by.y='ZIP5')
remove(MA2008)
remove(HeatSource2008)
remove(Intention2008)
remove(Fire2008)
remove(Address2008)
remove(FireAddress2008)

#2009
FIRE2009 <- read.dbf("fireincident2009.dbf")
ADDRESS2009 <- read.dbf("incidentaddress2009.dbf")
MA2009 <- filter(FIRE2009, STATE=="MA")
HeatSource2009 <- filter(MA2009, HEAT_SOURC==("61")|HEAT_SOURC==("62"))
Intention2009 <- filter(HeatSource2009, CAUSE_IGN==("1"))
Fire2009 <- mutate(Intention2009, PopClass=4, YEAR=2009)
Fire2009 <- select(Fire2009, STATE, INC_DATE, INC_NO, PopClass, YEAR)
INC_MON <- substr(Fire2009$INC_DATE, 1, nchar(Fire2009$INC_DATE)-6)
INC_MONTH <- t(INC_MON)
INC_MONTH <- t(INC_MONTH)
Fire2009 <- mutate(Fire2009, INC_MONTH)
Address2009 <- filter(ADDRESS2009, STATE=="MA")
Address2009 <- select(Address2009, STATE, INC_NO, ZIP5)
FireAddress2009 <- merge(Address2009, Fire2009, by.x='INC_NO', by.y='INC_NO')
FireLocat2009 <- merge(zipcode, FireAddress2009, by.x='zip', by.y='ZIP5')
remove(MA2009)
remove(HeatSource2009)
remove(Intention2009)
remove(Fire2009)
remove(Address2009)
remove(FireAddress2009)

#2010
FIRE2010 <- read.dbf("fireincident2010.dbf")
ADDRESS2010 <- read.dbf("incidentaddress2010.dbf")
MA2010 <- filter(FIRE2010, STATE=="MA")
HeatSource2010 <- filter(MA2010, HEAT_SOURC==("61")|HEAT_SOURC==("62"))
Intention2010 <- filter(HeatSource2010, CAUSE_IGN==("1"))
Fire2010 <- mutate(Intention2010, PopClass=5, YEAR=2010)
Fire2010 <- select(Fire2010, STATE, INC_DATE, INC_NO, PopClass, YEAR)
INC_MON <- substr(Fire2010$INC_DATE, 1, nchar(Fire2010$INC_DATE)-6)
INC_MONTH <- t(INC_MON)
INC_MONTH <- t(INC_MONTH)
Fire2010 <- mutate(Fire2010, INC_MONTH)
Address2010 <- filter(ADDRESS2010, STATE=="MA")
Address2010 <- select(Address2010, STATE, INC_NO, ZIP5)
FireAddress2010 <- merge(Address2010, Fire2010, by.x='INC_NO', by.y='INC_NO')
FireLocat2010 <- merge(zipcode, FireAddress2010, by.x='zip', by.y='ZIP5')
remove(MA2010)
remove(HeatSource2010)
remove(Intention2010)
remove(Fire2010)
remove(Address2010)
remove(FireAddress2010)

#2011
FIRE2011 <- read.dbf("fireincident2011.dbf")
ADDRESS2011 <- read.dbf("incidentaddress2011.dbf")
MA2011 <- filter(FIRE2011, STATE=="MA")
HeatSource2011 <- filter(MA2011, HEAT_SOURC==("61")|HEAT_SOURC==("62"))
Intention2011 <- filter(HeatSource2011, CAUSE_IGN==("1"))
Fire2011 <- mutate(Intention2011, PopClass=6, YEAR=2011)
Fire2011 <- select(Fire2011, STATE, INC_DATE, INC_NO, PopClass, YEAR)
INC_MON <- substr(Fire2011$INC_DATE, 1, nchar(Fire2011$INC_DATE)-6)
INC_MONTH <- t(INC_MON)
INC_MONTH <- t(INC_MONTH)
Fire2011 <- mutate(Fire2011, INC_MONTH)
Address2011 <- filter(ADDRESS2011, STATE=="MA")
Address2011 <- select(Address2011, STATE, INC_NO, ZIP5)
FireAddress2011 <- merge(Address2011, Fire2011, by.x='INC_NO', by.y='INC_NO')
FireLocat2011 <- merge(zipcode, FireAddress2011, by.x='zip', by.y='ZIP5')
remove(MA2011)
remove(HeatSource2011)
remove(Intention2011)
remove(Fire2011)
remove(Address2011)
remove(FireAddress2011)

#2012
FIRE2012 <- read.table("fireincident2012.txt",header = TRUE, sep="^", fill = TRUE)
ADDRESS2012 <- read.table("incidentaddress2012.txt",header = TRUE, sep="^", fill = TRUE)
MA2012 <- filter(FIRE2012, STATE=="MA")
HeatSource2012 <- filter(MA2012, HEAT_SOURC==("61")|HEAT_SOURC==("62"))
Intention2012 <- filter(HeatSource2012, CAUSE_IGN==("1"))
Fire2012 <- mutate(Intention2012, PopClass=7, YEAR=2012)
Fire2012 <- select(Fire2012, STATE, INC_DATE, INC_NO, PopClass, YEAR)
INC_MON <- substr(Fire2012$INC_DATE, 1, nchar(Fire2012$INC_DATE)-6)
INC_MONTH <- t(INC_MON)
INC_MONTH <- t(INC_MONTH)
Fire2012 <- mutate(Fire2012, INC_MONTH)
Address2012 <- filter(ADDRESS2012, STATE=="MA")
Address2012 <- select(Address2012, STATE, INC_NO, ZIP5)
FireAddress2012 <- merge(Address2012, Fire2012, by.x='INC_NO', by.y='INC_NO')
FireLocat2012 <- merge(zipcode, FireAddress2012, by.x='zip', by.y='ZIP5')
remove(MA2012)
remove(HeatSource2012)
remove(Intention2012)
remove(Fire2012)
remove(Address2012)
remove(FireAddress2012)

#2013
FIRE2013 <- read.table("fireincident2013.txt",header = TRUE, sep="^", fill = TRUE)
ADDRESS2013 <- read.table("incidentaddress2013.txt",header = TRUE, sep="^", fill = TRUE)
MA2013 <- filter(FIRE2013, STATE=="MA")
HeatSource2013 <- filter(MA2013, HEAT_SOURC==("61")|HEAT_SOURC==("62"))
Intention2013 <- filter(HeatSource2013, CAUSE_IGN==("1"))
Fire2013 <- mutate(Intention2013, PopClass=8, YEAR=2013)
Fire2013 <- select(Fire2013, STATE, INC_DATE, INC_NO, PopClass, YEAR)
INC_MON <- substr(Fire2013$INC_DATE, 1, nchar(Fire2013$INC_DATE)-6)
INC_MONTH <- t(INC_MON)
INC_MONTH <- t(INC_MONTH)
Fire2013 <- mutate(Fire2013, INC_MONTH)
Address2013 <- filter(ADDRESS2013, STATE=="MA")
Address2013 <- select(Address2013, STATE, INC_NO, ZIP5)
FireAddress2013 <- merge(Address2013, Fire2013, by.x='INC_NO', by.y='INC_NO')
FireLocat2013 <- merge(zipcode, FireAddress2013, by.x='zip', by.y='ZIP5')
remove(MA2013)
remove(HeatSource2013)
remove(Intention2013)
remove(Fire2013)
remove(Address2013)
remove(FireAddress2013)

#2014
FIRE2014 <- read.table("fireincident2014.txt",header = TRUE, sep="^", fill = TRUE)
ADDRESS2014 <- read.table("incidentaddress2014.txt",header = TRUE, sep="^", fill = TRUE)
MA2014 <- filter(FIRE2014, STATE=="MA")
HeatSource2014 <- filter(MA2014, HEAT_SOURC==("61")|HEAT_SOURC==("62"))
Intention2014 <- filter(HeatSource2014, CAUSE_IGN==("1"))
Fire2014 <- mutate(Intention2014, PopClass=9, YEAR=2014)
Fire2014 <- select(Fire2014, STATE, INC_DATE, INC_NO, PopClass, YEAR)
INC_MON <- substr(Fire2014$INC_DATE, 1, nchar(Fire2014$INC_DATE)-6)
INC_MONTH <- t(INC_MON)
INC_MONTH <- t(INC_MONTH)
Fire2014 <- mutate(Fire2014, INC_MONTH)
Address2014 <- filter(ADDRESS2014, STATE=="MA")
Address2014 <- select(Address2014, STATE, INC_NO, ZIP5)
FireAddress2014 <- merge(Address2014, Fire2014, by.x='INC_NO', by.y='INC_NO')
FireLocat2014 <- merge(zipcode, FireAddress2014, by.x='zip', by.y='ZIP5')
remove(MA2014)
remove(HeatSource2014)
remove(Intention2014)
remove(Fire2014)
remove(Address2014)
remove(FireAddress2014)

#2015
FIRE2015 <- read.table("fireincident2015.txt",header = TRUE, sep="^", fill = TRUE)
ADDRESS2015 <- read.table("incidentaddress2015.txt",header = TRUE, sep="^", fill = TRUE)
MA2015 <- filter(FIRE2015, STATE=="MA")
HeatSource2015 <- filter(MA2015, HEAT_SOURC==("61")|HEAT_SOURC==("62"))
Intention2015 <- filter(HeatSource2015, CAUSE_IGN==("1"))
Fire2015 <- mutate(Intention2015, PopClass=10, YEAR=2015)
Fire2015 <- select(Fire2015, STATE, INC_DATE, INC_NO, PopClass, YEAR)
INC_MON <- substr(Fire2015$INC_DATE, 1, nchar(Fire2015$INC_DATE)-6)
INC_MONTH <- t(INC_MON)
INC_MONTH <- t(INC_MONTH)
Fire2015 <- mutate(Fire2015, INC_MONTH)
Address2015 <- filter(ADDRESS2015, STATE=="MA")
Address2015 <- select(Address2015, STATE, INC_NO, ZIP5)
FireAddress2015 <- merge(Address2015, Fire2015, by.x='INC_NO', by.y='INC_NO')
FireLocat2015 <- merge(zipcode, FireAddress2015, by.x='zip', by.y='ZIP5')
remove(MA2015)
remove(HeatSource2015)
remove(Intention2015)
remove(Fire2015)
remove(Address2015)
remove(FireAddress2015)

FIRE_ADDRESS <- Reduce(function(x, y) merge(x, y, all=TRUE), list(FireLocat2006, FireLocat2007, 
                                                            FireLocat2008, FireLocat2009, 
                                                            FireLocat2010, FireLocat2011, 
                                                            FireLocat2012, FireLocat2013, 
                                                            FireLocat2014, FireLocat2015)) 
